SECURITY BUGS — identified 2026-02-22
=====================================

--- FIXED ---

1. Arbitrary file read via client-controlled inputPath
   Files: controllers/data-control.js, public/js/run.js, public/js/util/params.js
   Severity: Critical

   GET /check-file returned the full disk path of the uploaded file (filePath field).
   The client sent it back in the POST /submit body as inputPath. The server used that
   client-supplied value verbatim to read a file from disk via extractResumeText(inputPath).
   Any authenticated user could craft a POST request with an arbitrary path (.env, source
   files, etc.) and receive the contents embedded in the generated document.

   Fix: filePath stripped from GET /check-file response. inputPath in POST /submit body is
   now explicitly discarded. The server derives the file path server-side from the session
   via runCheckFile(req.session.id).

2. nukeOhio / pi flags not verified server-side
   File: controllers/data-control.js
   Severity: Critical

   The admin-only prebuilt mode (nukeOhio) and hidden-text feature (pi) were gated only
   in the browser via the admin modal flow. Any authenticated user could bypass the frontend
   entirely and POST { nukeOhio: true, pi: true } to use prebuilt mode and embed the hidden
   admin text in the output document.

   Fix: nukeOhio and pi are now gated on req.session.isAdmin in submitRouteController.
   Values from the request body are ignored unless the session carries admin status.


--- FIXED ---

3. Full disk path exposed in POST /upload response
   File: controllers/uploadResumeController (data-control.js)
   Severity: Low (information leakage, not currently exploitable)

   The upload response includes path: req.file.path, which is the full server-side disk path
   of the uploaded file. The frontend currently discards the return value of runUploadFile(),
   so this path is never used. However, it is still information leakage — a client inspecting
   the network response can learn the server's directory structure and session ID mapping.

   Fix: Removed path from the uploadResumeController response object.


ADDITIONAL REVIEW FINDINGS — 2026-02-22
========================================

--- FIXED ---

4. Session cookie missing security flags
   File: middleware/session-config.js
   Severity: Medium

   The session cookie was configured without httpOnly, sameSite, or secure
   flags. Without httpOnly, client-side JavaScript can read the cookie
   (XSS risk). Without sameSite: 'lax', cross-site requests can carry the
   session cookie. Without secure, the cookie is sent over plain HTTP in
   production environments.

   Fix: Added httpOnly: true, sameSite: 'lax', and
   secure: process.env.NODE_ENV === 'production' to the cookie config
   object in buildSessionConfig().

6. JSON.parse without try-catch
   File: src/resume.js
   Severity: High

   buildNewResume() called JSON.parse(aiText) with no error handling. If the
   AI returned malformed JSON or an error message string, the uncaught
   SyntaxError would crash the request handler and leave the client hanging
   with no response.

   Fix: Wrapped in try-catch; logs the error and returns null so the
   caller handles the failure gracefully.


--- NOT FIXED (deprioritized by user — personal tool, no sensitive data) ---

5. Plain string comparison for passwords (no timing-safe check)
   File: middleware/auth.js
   Severity: Medium

   Passwords are compared with === which is not timing-safe. A patient
   attacker making many requests could infer password content through
   subtle response time differences.

   Suggested fix: Use crypto.timingSafeEqual() for all password comparisons.
   (Deprioritized by user: passwords protect only a personal tool with no
   sensitive user data.)


--- FIXED ---

7. No rate limiting on authentication endpoints
   Files: controllers/auth-control.js
   Severity: Medium

   /site-auth-route and /admin-auth-submit accept unlimited password
   attempts with no delay or lockout. An automated brute-force attack is
   not blocked.

   Fix: In-memory Maps in auth-control.js track failed attempts per IP.
   After 10 failures in a 15-minute window, returns 429. Counter resets
   on successful login. No external package needed.


--- FIXED ---

8. No error handling in upload controller
   File: controllers/data-control.js (uploadResumeController)
   Severity: Medium

   The upload route has no try-catch around the multer/file-system
   operations. An unexpected error (disk full, permission denied, corrupt
   file) will propagate as an unhandled exception rather than returning a
   clean 500 to the client.

   Fix: Wrapped controller body in try-catch; returns structured 500 on
   failure. Also added null check in submitRouteController — previously
   a failed AI call caused res.send(null) which silently downloaded an
   empty file; now returns a clear 500 JSON response.


--- FIXED ---

9. No validation on POST /submit body parameters
   File: controllers/data-control.js
   Severity: Low

   modelType, temperature, maxTokens, and jobInput are forwarded to the
   AI pipeline without type checking or bounds validation. A malformed
   value (e.g. temperature: "drop table") will reach the OpenAI client
   and produce an unhelpful API error rather than a clear user-facing
   message.

   Fix: submitRouteController now explicitly destructures all known body
   params (dropping the unintentional route field that previously leaked
   through ...rest). Validates jobInput and modelType as non-empty strings;
   temperature as a finite non-negative number; maxTokens as a positive
   integer. Returns 400 with a clear message on failure.


--- LOW / COSMETIC ---

10. Commented-out code throughout codebase
    Files: src/resume.js, src/ai.js, src/message.js, public/js/run.js,
           controllers/data-control.js, and others
    Severity: Cosmetic

    Numerous commented-out console.log statements, dead import lines, and
    unused code blocks remain scattered across the codebase. These add
    noise without providing value since the project uses git for history.

    Suggested fix: Remove dead code; re-enable logging via a DEBUG env var
    or a lightweight logger if runtime introspection is needed.
